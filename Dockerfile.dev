# Development Dockerfile for Rails application - Debian-based for devcontainer compatibility
FROM ruby:3.2-slim

# Install system dependencies
RUN apt-get update -qq && apt-get install -y \
  build-essential \
  nodejs \
  npm \
  postgresql-client \
  sqlite3 \
  curl \
  git \
  && npm install -g yarn \
  && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /workspace/app

# Create app directory structure
RUN mkdir -p /workspace/app/app/controllers /workspace/app/app/models /workspace/app/config /workspace/app/db

# Copy application code if it exists
COPY app/ ./

# Install basic Rails if no Gemfile exists
RUN if [ ! -f "Gemfile" ]; then \
  gem install rails bundler sqlite3; \
  fi

# Install gems if Gemfile exists
RUN if [ -f "Gemfile" ]; then \
  bundle install || echo "Bundle install failed, continuing"; \
  fi

# Install JavaScript dependencies if package.json exists
RUN if [ -f "package.json" ]; then \
  yarn install --check-files || echo "Yarn install failed, continuing"; \
  fi

# Expose port
EXPOSE 3000

# Default command - use bash for development flexibility
CMD ["/bin/bash"]